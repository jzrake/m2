(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 9.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       157,          7]
NotebookDataLength[     44570,       1246]
NotebookOptionsPosition[     42613,       1175]
NotebookOutlinePosition[     43025,       1193]
CellTagsIndexPosition[     42982,       1190]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{
  RowBox[{"GenerateSourceTerms", "[", 
   RowBox[{"J_", ",", "grad_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"FluxS", ",", "\[Delta]"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"\[Delta]", ":=", "KroneckerDelta"}], ";", "\[IndentingNewLine]", 
     RowBox[{"FluxS", ":=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          SubscriptBox["S", "i"], 
          SubscriptBox["v", "j"]}], " ", "+", " ", 
         RowBox[{"p", " ", 
          RowBox[{"\[Delta]", "[", 
           RowBox[{"i", "-", "j"}], "]"}]}], "-", 
         RowBox[{
          SubscriptBox["b", "i"], 
          RowBox[{
           SubscriptBox["B", "j"], "/", "W"}]}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", "3"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "1", ",", "3"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Sum", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"J", ".", 
            RowBox[{
            "FluxS", "\[LeftDoubleBracket]", "j", "\[RightDoubleBracket]"}]}],
            ")"}], ".", 
          RowBox[{"grad", "[", 
           RowBox[{"J", "\[LeftDoubleBracket]", 
            RowBox[{"1", ",", "j"}], "\[RightDoubleBracket]"}], "]"}]}], ",", 
         
         RowBox[{"{", 
          RowBox[{"j", ",", "1", ",", "3"}], "}"}]}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Sum", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"J", ".", 
            RowBox[{
            "FluxS", "\[LeftDoubleBracket]", "j", "\[RightDoubleBracket]"}]}],
            ")"}], ".", 
          RowBox[{"grad", "[", 
           RowBox[{"J", "\[LeftDoubleBracket]", 
            RowBox[{"2", ",", "j"}], "\[RightDoubleBracket]"}], "]"}]}], ",", 
         
         RowBox[{"{", 
          RowBox[{"j", ",", "1", ",", "3"}], "}"}]}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Sum", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"J", ".", 
            RowBox[{
            "FluxS", "\[LeftDoubleBracket]", "j", "\[RightDoubleBracket]"}]}],
            ")"}], ".", 
          RowBox[{"grad", "[", 
           RowBox[{"J", "\[LeftDoubleBracket]", 
            RowBox[{"3", ",", "j"}], "\[RightDoubleBracket]"}], "]"}]}], ",", 
         
         RowBox[{"{", 
          RowBox[{"j", ",", "1", ",", "3"}], "}"}]}], "]"}]}], "}"}]}]}], 
   "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GetCFormNoPowers", "[", "expr_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "times", "}"}], ",", 
     RowBox[{"Apply", "[", 
      RowBox[{
       RowBox[{"Function", "[", 
        RowBox[{"code", ",", 
         RowBox[{"Hold", "[", 
          RowBox[{"CForm", "[", "code", "]"}], "]"}], ",", "HoldAll"}], "]"}],
        ",", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Hold", "[", "#", "]"}], "&"}], "[", 
         RowBox[{"expr", "/.", 
          RowBox[{
           RowBox[{
            RowBox[{"x_Symbol", "^", "y_Integer"}], "/;", 
            RowBox[{"y", ">", "1"}]}], "\[RuleDelayed]", 
           RowBox[{"times", "@@", 
            RowBox[{"Table", "[", 
             RowBox[{"x", ",", 
              RowBox[{"{", "y", "}"}]}], "]"}]}]}]}], "]"}], "/.", 
        RowBox[{"times", "\[Rule]", "Times"}]}]}], "]"}]}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.596573416624178*^9, 3.596573479773364*^9}, {
  3.596573542293345*^9, 3.596573554426354*^9}, {3.5965735944207687`*^9, 
  3.596573633308893*^9}, {3.596573780424633*^9, 3.596573805300932*^9}, {
  3.596573880544187*^9, 3.596573933633029*^9}, {3.596574033606847*^9, 
  3.596574034107127*^9}, {3.596575080614209*^9, 3.5965751035619164`*^9}}],

Cell[CellGroupData[{

Cell["Cylindrical geometry", "Section",
 CellChangeTimes->{{3.5965741236744423`*^9, 3.596574127312907*^9}}],

Cell[CellGroupData[{

Cell["Source term density and volume integrated", "Subsection",
 CellChangeTimes->{{3.5965747973711967`*^9, 3.596574807632786*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"gradCylindrical", "=", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       SubscriptBox["\[PartialD]", "r"], "#"}], ",", 
      RowBox[{
       FractionBox["1", "r"], 
       RowBox[{
        SubscriptBox["\[PartialD]", "\[Phi]"], "#"}]}], ",", 
      RowBox[{
       SubscriptBox["\[PartialD]", "z"], "#"}]}], "}"}], "&"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"JCylindrical", ":=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Cos", "[", "\[Phi]", "]"}], ",", 
      RowBox[{"Sin", "[", "\[Phi]", "]"}], ",", "0"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"-", 
       RowBox[{"Sin", "[", "\[Phi]", "]"}]}], ",", 
      RowBox[{"Cos", "[", "\[Phi]", "]"}], ",", "0"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], 
   "}"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ToCylindrical", "=", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        SubscriptBox["v", "i"], "\[Rule]", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Simplify", "[", 
            RowBox[{"Inverse", "@", "JCylindrical"}], "]"}], ".", 
           RowBox[{"{", 
            RowBox[{"vr", ",", "v\[Phi]", ",", "vz"}], "}"}]}], ")"}], 
         "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "1", ",", "3"}], "}"}]}], "]"}], ")"}], "~", "Join",
     "~", "\[IndentingNewLine]", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{
       SubscriptBox["S", "i"], "\[Rule]", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Simplify", "[", 
           RowBox[{"Inverse", "@", "JCylindrical"}], "]"}], ".", 
          RowBox[{"{", 
           RowBox[{"Sr", ",", "S\[Phi]", ",", "Sz"}], "}"}]}], ")"}], 
        "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", "1", ",", "3"}], "}"}]}], "]"}], "~", "Join", "~", 
    "\[IndentingNewLine]", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{
       SubscriptBox["b", "i"], "\[Rule]", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Simplify", "[", 
           RowBox[{"Inverse", "@", "JCylindrical"}], "]"}], ".", 
          RowBox[{"{", 
           RowBox[{"br", ",", "b\[Phi]", ",", "bz"}], "}"}]}], ")"}], 
        "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", "1", ",", "3"}], "}"}]}], "]"}], "~", "Join", "~", 
    "\[IndentingNewLine]", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{
       SubscriptBox["B", "i"], "\[Rule]", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Simplify", "[", 
           RowBox[{"Inverse", "@", "JCylindrical"}], "]"}], ".", 
          RowBox[{"{", 
           RowBox[{"Br", ",", "B\[Phi]", ",", "Bz"}], "}"}]}], ")"}], 
        "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", "1", ",", "3"}], "}"}]}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"CFormSubstitutesCylindrical", "=", 
   RowBox[{"{", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"\[Phi]0", "\[Rule]", "f0"}], ",", "\[IndentingNewLine]", 
     RowBox[{"\[Phi]1", "\[Rule]", "f1"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Sr", "\[Rule]", "S1"}], ",", 
     RowBox[{"vr", "\[Rule]", "v1"}], ",", 
     RowBox[{"Br", "\[Rule]", "b1"}], ",", 
     RowBox[{"br", "\[Rule]", "B1"}], ",", "\[IndentingNewLine]", 
     RowBox[{"S\[Phi]", "\[Rule]", "S2"}], ",", 
     RowBox[{"v\[Phi]", "\[Rule]", "v2"}], ",", 
     RowBox[{"B\[Phi]", "\[Rule]", "b2"}], ",", 
     RowBox[{"b\[Phi]", "\[Rule]", "B2"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Sz", "\[Rule]", "S3"}], ",", 
     RowBox[{"vz", "\[Rule]", "v3"}], ",", 
     RowBox[{"Bz", "\[Rule]", "b3"}], ",", 
     RowBox[{"bz", "\[Rule]", "B3"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Sin", "\[Rule]", "sin"}], ",", 
     RowBox[{"Cos", "\[Rule]", "cos"}], ",", 
     RowBox[{"W", "\[Rule]", "u0"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MakeExactVolumeCylindrical", "[", "source_", "]"}], ":=", 
  RowBox[{"Integrate", "[", 
   RowBox[{
    RowBox[{"source", 
     RowBox[{"(", "r", ")"}]}], ",", 
    RowBox[{"{", 
     RowBox[{"r", ",", "r0", ",", "r1"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"\[Phi]", ",", "\[Phi]0", ",", "\[Phi]1"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"z", ",", "z0", ",", "z1"}], "}"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"CylindricalSources", "=", 
  RowBox[{
   RowBox[{
    RowBox[{"GenerateSourceTerms", "[", 
     RowBox[{"JCylindrical", ",", "gradCylindrical"}], "]"}], "/.", 
    "ToCylindrical"}], "//", "FullSimplify"}]}], "\[IndentingNewLine]", 
 RowBox[{"CylindricalSourcesExact", "=", 
  RowBox[{
   RowBox[{"MakeExactVolumeCylindrical", "[", "CylindricalSources", "]"}], "//",
    "FullSimplify"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GetCFormNoPowers", "[", 
    RowBox[{"#", "/.", "CFormSubstitutesCylindrical"}], "]"}], "&"}], "/@", 
  "CylindricalSourcesExact"}]}], "Input",
 CellChangeTimes->{{3.596574040425845*^9, 3.5965740786326427`*^9}, {
  3.596574154005721*^9, 3.5965741557914963`*^9}, {3.5965741981904163`*^9, 
  3.596574198568797*^9}, {3.5965742591352882`*^9, 3.596574374834216*^9}, {
  3.5965744417514677`*^9, 3.596574465176072*^9}, {3.5965745616315117`*^9, 
  3.5965745630285873`*^9}, {3.5965745939715223`*^9, 3.59657460815626*^9}, {
  3.596574650367168*^9, 3.596574751601514*^9}, {3.596575114587825*^9, 
  3.596575244844625*^9}, {3.596575280637342*^9, 3.596575450624991*^9}, {
  3.596575542951082*^9, 3.5965755441240873`*^9}, {3.596575910411922*^9, 
  3.596575912100449*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   FractionBox[
    RowBox[{
     RowBox[{
      RowBox[{"-", "b\[Phi]"}], " ", "B\[Phi]"}], "+", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"p", "+", 
        RowBox[{"S\[Phi]", " ", "v\[Phi]"}]}], ")"}], " ", "W"}]}], 
    RowBox[{"r", " ", "W"}]], ",", 
   FractionBox[
    RowBox[{
     RowBox[{"br", " ", "B\[Phi]"}], "-", 
     RowBox[{"Sr", " ", "v\[Phi]", " ", "W"}]}], 
    RowBox[{"r", " ", "W"}]], ",", "0"}], "}"}]], "Output",
 CellChangeTimes->{
  3.5965740841919727`*^9, {3.596574570674879*^9, 3.596574608824235*^9}, {
   3.596574657063348*^9, 3.596574728957223*^9}, 3.59657519903957*^9, 
   3.596575246463324*^9, {3.596575286868017*^9, 3.5965753826319027`*^9}, {
   3.596575416218994*^9, 3.596575428438047*^9}, 3.5965757840107307`*^9, 
   3.5965759140379553`*^9, 3.596576938255638*^9, 3.596601261279647*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   FractionBox[
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{"-", "r0"}], "+", "r1"}], ")"}], " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"-", "b\[Phi]"}], " ", "B\[Phi]"}], "+", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"p", "+", 
          RowBox[{"S\[Phi]", " ", "v\[Phi]"}]}], ")"}], " ", "W"}]}], ")"}], 
     " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"-", "z0"}], "+", "z1"}], ")"}], " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"-", "\[Phi]0"}], "+", "\[Phi]1"}], ")"}]}], "W"], ",", 
   FractionBox[
    RowBox[{
     RowBox[{"(", 
      RowBox[{"r0", "-", "r1"}], ")"}], " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"-", "br"}], " ", "B\[Phi]"}], "+", 
       RowBox[{"Sr", " ", "v\[Phi]", " ", "W"}]}], ")"}], " ", 
     RowBox[{"(", 
      RowBox[{"z0", "-", "z1"}], ")"}], " ", 
     RowBox[{"(", 
      RowBox[{"\[Phi]0", "-", "\[Phi]1"}], ")"}]}], "W"], ",", "0"}], 
  "}"}]], "Output",
 CellChangeTimes->{
  3.5965740841919727`*^9, {3.596574570674879*^9, 3.596574608824235*^9}, {
   3.596574657063348*^9, 3.596574728957223*^9}, 3.59657519903957*^9, 
   3.596575246463324*^9, {3.596575286868017*^9, 3.5965753826319027`*^9}, {
   3.596575416218994*^9, 3.596575428438047*^9}, 3.5965757840107307`*^9, 
   3.5965759140379553`*^9, 3.596576938255638*^9, 3.5966012613961897`*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"Hold", "[", 
    InterpretationBox["\<\"((-f0 + f1)*(-r0 + r1)*(-(b2*B2) + u0*(p + \
S2*v2))*(-z0 + z1))/u0\"\>",
     CForm[(-$CellContext`f0 + $CellContext`f1) (-$CellContext`r0 + \
$CellContext`r1) $CellContext`u0^(-1) (-$CellContext`b2 $CellContext`B2 + \
$CellContext`u0 ($CellContext`p + $CellContext`S2 $CellContext`v2)) \
(-$CellContext`z0 + $CellContext`z1)],
     AutoDelete->True,
     Editable->True], "]"}], ",", 
   RowBox[{"Hold", "[", 
    InterpretationBox["\<\"((f0 - f1)*(r0 - r1)*(-(B1*b2) + S1*u0*v2)*(z0 - \
z1))/u0\"\>",
     CForm[($CellContext`f0 - $CellContext`f1) ($CellContext`r0 - \
$CellContext`r1) $CellContext`u0^(-1) (-$CellContext`B1 $CellContext`b2 + \
$CellContext`S1 $CellContext`u0 $CellContext`v2) ($CellContext`z0 - \
$CellContext`z1)],
     AutoDelete->True,
     Editable->True], "]"}], ",", 
   RowBox[{"Hold", "[", 
    InterpretationBox["\<\"0\"\>",
     CForm[0],
     AutoDelete->True,
     Editable->True], "]"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.5965740841919727`*^9, {3.596574570674879*^9, 3.596574608824235*^9}, {
   3.596574657063348*^9, 3.596574728957223*^9}, 3.59657519903957*^9, 
   3.596575246463324*^9, {3.596575286868017*^9, 3.5965753826319027`*^9}, {
   3.596575416218994*^9, 3.596575428438047*^9}, 3.5965757840107307`*^9, 
   3.5965759140379553`*^9, 3.596576938255638*^9, 3.596601261398115*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Volume and area measures", "Subsection",
 CellChangeTimes->{{3.596574770745476*^9, 3.596574774116458*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"Integrate", "[", 
   RowBox[{"r", ",", 
    RowBox[{"{", 
     RowBox[{"r", ",", "r0", ",", "r1"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"\[Phi]", ",", "\[Phi]0", ",", "\[Phi]1"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"z", ",", "z0", ",", "z1"}], "}"}]}], "]"}], "//", 
  "FullSimplify"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Integrate", "[", 
   RowBox[{"r", ",", 
    RowBox[{"{", 
     RowBox[{"\[Phi]", ",", "\[Phi]0", ",", "\[Phi]1"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"z", ",", "z0", ",", "z1"}], "}"}]}], "]"}], "//", 
  "FullSimplify"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Integrate", "[", 
   RowBox[{"1", ",", 
    RowBox[{"{", 
     RowBox[{"z", ",", "z0", ",", "z1"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"r", ",", "r0", ",", "r1"}], "}"}]}], "]"}], "//", 
  "FullSimplify"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Integrate", "[", 
   RowBox[{"r", ",", 
    RowBox[{"{", 
     RowBox[{"r", ",", "r0", ",", "r1"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"\[Phi]", ",", "\[Phi]0", ",", "\[Phi]1"}], "}"}]}], "]"}], "//",
   "FullSimplify"}]}], "Input",
 CellChangeTimes->{
  3.596574823860488*^9, {3.596574873548223*^9, 3.596574885674889*^9}, {
   3.596574916379836*^9, 3.5965750163368893`*^9}, {3.596575880819735*^9, 
   3.59657588568262*^9}, {3.59657696918258*^9, 3.5965769692551737`*^9}, {
   3.59659995453743*^9, 3.596599969438395*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"-", 
   FractionBox["1", "2"]}], " ", 
  RowBox[{"(", 
   RowBox[{"r0", "-", "r1"}], ")"}], " ", 
  RowBox[{"(", 
   RowBox[{"r0", "+", "r1"}], ")"}], " ", 
  RowBox[{"(", 
   RowBox[{"z0", "-", "z1"}], ")"}], " ", 
  RowBox[{"(", 
   RowBox[{"\[Phi]0", "-", "\[Phi]1"}], ")"}]}]], "Output",
 CellChangeTimes->{
  3.5965748901387367`*^9, 3.596574938603731*^9, {3.596574991693387*^9, 
   3.596575016847928*^9}, 3.596575886235675*^9, 3.596576938481679*^9, 
   3.5965769697210293`*^9, 3.596601261442539*^9}],

Cell[BoxData[
 RowBox[{"r", " ", 
  RowBox[{"(", 
   RowBox[{"z0", "-", "z1"}], ")"}], " ", 
  RowBox[{"(", 
   RowBox[{"\[Phi]0", "-", "\[Phi]1"}], ")"}]}]], "Output",
 CellChangeTimes->{
  3.5965748901387367`*^9, 3.596574938603731*^9, {3.596574991693387*^9, 
   3.596575016847928*^9}, 3.596575886235675*^9, 3.596576938481679*^9, 
   3.5965769697210293`*^9, 3.5966012614438334`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(", 
   RowBox[{"r0", "-", "r1"}], ")"}], " ", 
  RowBox[{"(", 
   RowBox[{"z0", "-", "z1"}], ")"}]}]], "Output",
 CellChangeTimes->{
  3.5965748901387367`*^9, 3.596574938603731*^9, {3.596574991693387*^9, 
   3.596575016847928*^9}, 3.596575886235675*^9, 3.596576938481679*^9, 
   3.5965769697210293`*^9, 3.596601261444886*^9}],

Cell[BoxData[
 RowBox[{
  FractionBox["1", "2"], " ", 
  RowBox[{"(", 
   RowBox[{"r0", "-", "r1"}], ")"}], " ", 
  RowBox[{"(", 
   RowBox[{"r0", "+", "r1"}], ")"}], " ", 
  RowBox[{"(", 
   RowBox[{"\[Phi]0", "-", "\[Phi]1"}], ")"}]}]], "Output",
 CellChangeTimes->{
  3.5965748901387367`*^9, 3.596574938603731*^9, {3.596574991693387*^9, 
   3.596575016847928*^9}, 3.596575886235675*^9, 3.596576938481679*^9, 
   3.5965769697210293`*^9, 3.59660126144613*^9}]
}, Open  ]]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Spherical geometry", "Section",
 CellChangeTimes->{{3.596574135018383*^9, 3.5965741410746393`*^9}}],

Cell[CellGroupData[{

Cell["\<\
Source term density and volume integrated\
\>", "Subsection",
 CellChangeTimes->{{3.5965747973711967`*^9, 3.596574807632786*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"gradSpherical", "=", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       SubscriptBox["\[PartialD]", "r"], "#"}], ",", 
      RowBox[{
       FractionBox["1", "r"], 
       RowBox[{
        SubscriptBox["\[PartialD]", "\[Theta]"], "#"}]}], ",", 
      RowBox[{
       FractionBox["1", 
        RowBox[{"r", " ", 
         RowBox[{"Sin", "[", "\[Theta]", "]"}]}]], 
       RowBox[{
        SubscriptBox["\[PartialD]", "\[Phi]"], "#"}]}]}], "}"}], "&"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"JSpherical", ":=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{"Sin", "[", "\[Theta]", "]"}], 
       RowBox[{"Cos", "[", "\[Phi]", "]"}]}], ",", 
      RowBox[{
       RowBox[{"Sin", "[", "\[Theta]", "]"}], 
       RowBox[{"Sin", "[", "\[Phi]", "]"}]}], ",", 
      RowBox[{"Cos", "[", "\[Theta]", "]"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{"Cos", "[", "\[Theta]", "]"}], 
       RowBox[{"Cos", "[", "\[Phi]", "]"}]}], ",", 
      RowBox[{
       RowBox[{"Cos", "[", "\[Theta]", "]"}], 
       RowBox[{"Sin", "[", "\[Phi]", "]"}]}], ",", 
      RowBox[{"-", 
       RowBox[{"Sin", "[", "\[Theta]", "]"}]}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"-", 
       RowBox[{"Sin", "[", "\[Phi]", "]"}]}], ",", 
      RowBox[{"Cos", "[", "\[Phi]", "]"}], ",", "0"}], "}"}]}], 
   "}"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ToSpherical", "=", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        SubscriptBox["v", "i"], "\[Rule]", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Simplify", "[", 
            RowBox[{"Inverse", "@", "JSpherical"}], "]"}], ".", 
           RowBox[{"{", 
            RowBox[{"vr", ",", "v\[Theta]", ",", "v\[Phi]"}], "}"}]}], ")"}], 
         "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "1", ",", "3"}], "}"}]}], "]"}], ")"}], "~", "Join",
     "~", "\[IndentingNewLine]", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{
       SubscriptBox["S", "i"], "\[Rule]", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Simplify", "[", 
           RowBox[{"Inverse", "@", "JSpherical"}], "]"}], ".", 
          RowBox[{"{", 
           RowBox[{"Sr", ",", "S\[Theta]", ",", "S\[Phi]"}], "}"}]}], ")"}], 
        "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", "1", ",", "3"}], "}"}]}], "]"}], "~", "Join", "~", 
    "\[IndentingNewLine]", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{
       SubscriptBox["b", "i"], "\[Rule]", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Simplify", "[", 
           RowBox[{"Inverse", "@", "JSpherical"}], "]"}], ".", 
          RowBox[{"{", 
           RowBox[{"br", ",", "b\[Theta]", ",", "b\[Phi]"}], "}"}]}], ")"}], 
        "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", "1", ",", "3"}], "}"}]}], "]"}], "~", "Join", "~", 
    "\[IndentingNewLine]", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{
       SubscriptBox["B", "i"], "\[Rule]", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Simplify", "[", 
           RowBox[{"Inverse", "@", "JSpherical"}], "]"}], ".", 
          RowBox[{"{", 
           RowBox[{"Br", ",", "B\[Theta]", ",", "B\[Phi]"}], "}"}]}], ")"}], 
        "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", "1", ",", "3"}], "}"}]}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"CFormSubstitutesSpherical", "=", 
   RowBox[{"{", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"\[Theta]0", "\[Rule]", "t0"}], ",", 
     RowBox[{"\[Phi]0", "\[Rule]", "f0"}], ",", "\[IndentingNewLine]", 
     RowBox[{"\[Theta]1", "\[Rule]", "t1"}], ",", 
     RowBox[{"\[Phi]1", "\[Rule]", "f1"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Sr", "\[Rule]", "S1"}], ",", 
     RowBox[{"vr", "\[Rule]", "v1"}], ",", 
     RowBox[{"Br", "\[Rule]", "b1"}], ",", 
     RowBox[{"br", "\[Rule]", "B1"}], ",", "\[IndentingNewLine]", 
     RowBox[{"S\[Theta]", "\[Rule]", "S2"}], ",", 
     RowBox[{"v\[Theta]", "\[Rule]", "v2"}], ",", 
     RowBox[{"B\[Theta]", "\[Rule]", "b2"}], ",", 
     RowBox[{"b\[Theta]", "\[Rule]", "B2"}], ",", "\[IndentingNewLine]", 
     RowBox[{"S\[Phi]", "\[Rule]", "S3"}], ",", 
     RowBox[{"v\[Phi]", "\[Rule]", "v3"}], ",", 
     RowBox[{"B\[Phi]", "\[Rule]", "b3"}], ",", 
     RowBox[{"b\[Phi]", "\[Rule]", "B3"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Sin", "\[Rule]", "sin"}], ",", 
     RowBox[{"Cos", "\[Rule]", "cos"}], ",", 
     RowBox[{"W", "\[Rule]", "u0"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MakeExactVolumeSpherical", "[", "source_", "]"}], ":=", 
  RowBox[{"Integrate", "[", 
   RowBox[{
    RowBox[{"source", 
     RowBox[{"(", 
      RowBox[{
       SuperscriptBox["r", "2"], 
       RowBox[{"Sin", "[", "\[Theta]", "]"}]}], ")"}]}], ",", 
    RowBox[{"{", 
     RowBox[{"r", ",", "r0", ",", "r1"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"\[Theta]", ",", "\[Theta]0", ",", "\[Theta]1"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"\[Phi]", ",", "\[Phi]0", ",", "\[Phi]1"}], "}"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"SphericalSources", "=", 
  RowBox[{
   RowBox[{
    RowBox[{"GenerateSourceTerms", "[", 
     RowBox[{"JSpherical", ",", "gradSpherical"}], "]"}], "/.", 
    "ToSpherical"}], "//", "FullSimplify"}]}], "\[IndentingNewLine]", 
 RowBox[{"SphericalSourcesExact", "=", 
  RowBox[{
   RowBox[{"MakeExactVolumeSpherical", "[", "SphericalSources", "]"}], "//", 
   "FullSimplify"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GetCFormNoPowers", "[", 
    RowBox[{"#", "/.", "CFormSubstitutesSpherical"}], "]"}], "&"}], "/@", 
  "SphericalSourcesExact"}]}], "Input",
 CellChangeTimes->{{3.596575110122899*^9, 3.5965751672094927`*^9}, {
  3.596575464081008*^9, 3.5965754837335567`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   FractionBox[
    RowBox[{
     RowBox[{
      RowBox[{"-", "b\[Theta]"}], " ", "B\[Theta]"}], "-", 
     RowBox[{"b\[Phi]", " ", "B\[Phi]"}], "+", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"2", " ", "p"}], "+", 
        RowBox[{"S\[Theta]", " ", "v\[Theta]"}], "+", 
        RowBox[{"S\[Phi]", " ", "v\[Phi]"}]}], ")"}], " ", "W"}]}], 
    RowBox[{"r", " ", "W"}]], ",", 
   FractionBox[
    RowBox[{
     RowBox[{"br", " ", "B\[Theta]"}], "-", 
     RowBox[{"Sr", " ", "v\[Theta]", " ", "W"}], "+", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"-", "b\[Phi]"}], " ", "B\[Phi]"}], "+", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"p", "+", 
           RowBox[{"S\[Phi]", " ", "v\[Phi]"}]}], ")"}], " ", "W"}]}], ")"}], 
      " ", 
      RowBox[{"Cot", "[", "\[Theta]", "]"}]}]}], 
    RowBox[{"r", " ", "W"}]], ",", 
   FractionBox[
    RowBox[{
     RowBox[{"br", " ", "B\[Phi]"}], "-", 
     RowBox[{"Sr", " ", "v\[Phi]", " ", "W"}], "+", 
     RowBox[{"b\[Theta]", " ", "B\[Phi]", " ", 
      RowBox[{"Cot", "[", "\[Theta]", "]"}]}], "-", 
     RowBox[{"S\[Theta]", " ", "v\[Phi]", " ", "W", " ", 
      RowBox[{"Cot", "[", "\[Theta]", "]"}]}]}], 
    RowBox[{"r", " ", "W"}]]}], "}"}]], "Output",
 CellChangeTimes->{3.5965747916426487`*^9, 3.596575485111684*^9, 
  3.596576939408422*^9, 3.5966012623458023`*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    FractionBox["1", 
     RowBox[{"2", " ", "W"}]], 
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{"-", 
        SuperscriptBox["r0", "2"]}], "+", 
       SuperscriptBox["r1", "2"]}], ")"}], " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"b\[Theta]", " ", "B\[Theta]"}], "+", 
       RowBox[{"b\[Phi]", " ", "B\[Phi]"}], "-", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"2", " ", "p"}], "+", 
          RowBox[{"S\[Theta]", " ", "v\[Theta]"}], "+", 
          RowBox[{"S\[Phi]", " ", "v\[Phi]"}]}], ")"}], " ", "W"}]}], ")"}], 
     " ", 
     RowBox[{"(", 
      RowBox[{"\[Phi]0", "-", "\[Phi]1"}], ")"}], " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"Cos", "[", "\[Theta]0", "]"}], "-", 
       RowBox[{"Cos", "[", "\[Theta]1", "]"}]}], ")"}]}]}], ",", 
   RowBox[{
    FractionBox["1", 
     RowBox[{"2", " ", "W"}]], 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"r0", "-", "r1"}], ")"}], " ", 
     RowBox[{"(", 
      RowBox[{"r0", "+", "r1"}], ")"}], " ", 
     RowBox[{"(", 
      RowBox[{"\[Phi]0", "-", "\[Phi]1"}], ")"}], " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"br", " ", "B\[Theta]"}], "-", 
          RowBox[{"Sr", " ", "v\[Theta]", " ", "W"}]}], ")"}], " ", 
        RowBox[{"Cos", "[", "\[Theta]0", "]"}]}], "+", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"-", "br"}], " ", "B\[Theta]"}], "+", 
          RowBox[{"Sr", " ", "v\[Theta]", " ", "W"}]}], ")"}], " ", 
        RowBox[{"Cos", "[", "\[Theta]1", "]"}]}], "+", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"b\[Phi]", " ", "B\[Phi]"}], "-", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"p", "+", 
             RowBox[{"S\[Phi]", " ", "v\[Phi]"}]}], ")"}], " ", "W"}]}], 
         ")"}], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Sin", "[", "\[Theta]0", "]"}], "-", 
          RowBox[{"Sin", "[", "\[Theta]1", "]"}]}], ")"}]}]}], ")"}]}]}], ",", 
   RowBox[{
    FractionBox["1", 
     RowBox[{"2", " ", "W"}]], 
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{"-", 
        SuperscriptBox["r0", "2"]}], "+", 
       SuperscriptBox["r1", "2"]}], ")"}], " ", 
     RowBox[{"(", 
      RowBox[{"\[Phi]0", "-", "\[Phi]1"}], ")"}], " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"-", "br"}], " ", "B\[Phi]"}], "+", 
          RowBox[{"Sr", " ", "v\[Phi]", " ", "W"}]}], ")"}], " ", 
        RowBox[{"Cos", "[", "\[Theta]0", "]"}]}], "+", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"br", " ", "B\[Phi]"}], "-", 
          RowBox[{"Sr", " ", "v\[Phi]", " ", "W"}]}], ")"}], " ", 
        RowBox[{"Cos", "[", "\[Theta]1", "]"}]}], "+", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"b\[Theta]", " ", "B\[Phi]"}], "-", 
          RowBox[{"S\[Theta]", " ", "v\[Phi]", " ", "W"}]}], ")"}], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Sin", "[", "\[Theta]0", "]"}], "-", 
          RowBox[{"Sin", "[", "\[Theta]1", "]"}]}], ")"}]}]}], ")"}]}]}]}], 
  "}"}]], "Output",
 CellChangeTimes->{3.5965747916426487`*^9, 3.596575485111684*^9, 
  3.596576939408422*^9, 3.596601272996853*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"Hold", "[", 
    InterpretationBox["\<\"((f0 - f1)*(b2*B2 + b3*B3 - u0*(2*p + S2*v2 + \
S3*v3))*(cos(t0) - cos(t1))*(-(r0*r0) + r1*r1))/(2.*u0)\"\>",
     CForm[
     Rational[1, 
        2] ($CellContext`f0 - $CellContext`f1) $CellContext`u0^(-1) \
($CellContext`b2 $CellContext`B2 + $CellContext`b3 $CellContext`B3 - \
$CellContext`u0 (
        2 $CellContext`p + $CellContext`S2 $CellContext`v2 + $CellContext`S3 \
$CellContext`v3)) ($CellContext`cos[$CellContext`t0] - \
$CellContext`cos[$CellContext`t1]) (-($CellContext`r0 $CellContext`r0) + \
$CellContext`r1 $CellContext`r1)],
     AutoDelete->True,
     Editable->True], "]"}], ",", 
   RowBox[{"Hold", "[", 
    InterpretationBox["\<\"((f0 - f1)*(r0 - r1)*(r0 + r1)*((B1*b2 - \
S1*u0*v2)*cos(t0) + (-(B1*b2) + S1*u0*v2)*cos(t1) + (b3*B3 - u0*(p + \
S3*v3))*(sin(t0) - sin(t1))))/(2.*u0)\"\>",
     CForm[
     Rational[1, 
        2] ($CellContext`f0 - $CellContext`f1) ($CellContext`r0 - \
$CellContext`r1) ($CellContext`r0 + $CellContext`r1) $CellContext`u0^(-1) \
(($CellContext`B1 $CellContext`b2 - $CellContext`S1 $CellContext`u0 \
$CellContext`v2) $CellContext`cos[$CellContext`t0] + (-$CellContext`B1 \
$CellContext`b2 + $CellContext`S1 $CellContext`u0 $CellContext`v2) \
$CellContext`cos[$CellContext`t1] + ($CellContext`b3 $CellContext`B3 - \
$CellContext`u0 ($CellContext`p + $CellContext`S3 $CellContext`v3)) \
($CellContext`sin[$CellContext`t0] - $CellContext`sin[$CellContext`t1]))],
     AutoDelete->True,
     Editable->True], "]"}], ",", 
   RowBox[{"Hold", "[", 
    InterpretationBox["\<\"((f0 - f1)*((-(B1*b3) + S1*u0*v3)*cos(t0) + (B1*b3 \
- S1*u0*v3)*cos(t1) + (B2*b3 - S2*u0*v3)*(sin(t0) - sin(t1)))*(-(r0*r0) + \
r1*r1))/(2.*u0)\"\>",
     CForm[
     Rational[1, 
        2] ($CellContext`f0 - $CellContext`f1) $CellContext`u0^(-1) \
((-$CellContext`B1 $CellContext`b3 + $CellContext`S1 $CellContext`u0 \
$CellContext`v3) $CellContext`cos[$CellContext`t0] + ($CellContext`B1 \
$CellContext`b3 - $CellContext`S1 $CellContext`u0 $CellContext`v3) \
$CellContext`cos[$CellContext`t1] + ($CellContext`B2 $CellContext`b3 - \
$CellContext`S2 $CellContext`u0 $CellContext`v3) \
($CellContext`sin[$CellContext`t0] - $CellContext`sin[$CellContext`t1])) \
(-($CellContext`r0 $CellContext`r0) + $CellContext`r1 $CellContext`r1)],
     AutoDelete->True,
     Editable->True], "]"}]}], "}"}]], "Output",
 CellChangeTimes->{3.5965747916426487`*^9, 3.596575485111684*^9, 
  3.596576939408422*^9, 3.5966012729996767`*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Volume and area measures", "Subsection",
 CellChangeTimes->{{3.596574770745476*^9, 3.596574774116458*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"Integrate", "[", 
   RowBox[{
    RowBox[{
     SuperscriptBox["r", "2"], 
     RowBox[{"Sin", "[", "\[Theta]", "]"}]}], ",", 
    RowBox[{"{", 
     RowBox[{"r", ",", "r0", ",", "r1"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"\[Theta]", ",", "\[Theta]0", ",", "\[Theta]1"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"\[Phi]", ",", "\[Phi]0", ",", "\[Phi]1"}], "}"}]}], "]"}], "//",
   "FullSimplify"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Integrate", "[", 
   RowBox[{
    RowBox[{
     SuperscriptBox["r", "2"], 
     RowBox[{"Sin", "[", "\[Theta]", "]"}]}], ",", 
    RowBox[{"{", 
     RowBox[{"\[Theta]", ",", "\[Theta]0", ",", "\[Theta]1"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"\[Phi]", ",", "\[Phi]0", ",", "\[Phi]1"}], "}"}]}], "]"}], "//",
   "FullSimplify"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Integrate", "[", 
   RowBox[{
    RowBox[{"r", " ", 
     RowBox[{"Sin", "[", "\[Theta]", "]"}]}], ",", 
    RowBox[{"{", 
     RowBox[{"\[Phi]", ",", "\[Phi]0", ",", "\[Phi]1"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"r", ",", "r0", ",", "r1"}], "}"}]}], "]"}], "//", 
  "FullSimplify"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Integrate", "[", 
   RowBox[{"r", ",", 
    RowBox[{"{", 
     RowBox[{"r", ",", "r0", ",", "r1"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"\[Theta]", ",", "\[Theta]0", ",", "\[Theta]1"}], "}"}]}], "]"}],
   "//", "FullSimplify"}]}], "Input",
 CellChangeTimes->{{3.596574833932426*^9, 3.596574862075502*^9}, {
  3.596599980071281*^9, 3.5965999936325407`*^9}, {3.596600089206732*^9, 
  3.596600092038412*^9}, {3.596601223346594*^9, 3.596601224257265*^9}}],

Cell[BoxData[
 RowBox[{
  FractionBox["1", "3"], " ", 
  RowBox[{"(", 
   RowBox[{
    SuperscriptBox["r0", "3"], "-", 
    SuperscriptBox["r1", "3"]}], ")"}], " ", 
  RowBox[{"(", 
   RowBox[{"\[Phi]0", "-", "\[Phi]1"}], ")"}], " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Cos", "[", "\[Theta]0", "]"}], "-", 
    RowBox[{"Cos", "[", "\[Theta]1", "]"}]}], ")"}]}]], "Output",
 CellChangeTimes->{3.5965747653942633`*^9, 3.596574866366969*^9, 
  3.596576950722261*^9, 3.596599998652176*^9, 3.596600092981669*^9, 
  3.596601226999567*^9, 3.5966012733959837`*^9}],

Cell[BoxData[
 RowBox[{
  SuperscriptBox["r", "2"], " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"-", "\[Phi]0"}], "+", "\[Phi]1"}], ")"}], " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Cos", "[", "\[Theta]0", "]"}], "-", 
    RowBox[{"Cos", "[", "\[Theta]1", "]"}]}], ")"}]}]], "Output",
 CellChangeTimes->{3.5965747653942633`*^9, 3.596574866366969*^9, 
  3.596576950722261*^9, 3.596599998652176*^9, 3.596600092981669*^9, 
  3.596601226999567*^9, 3.596601273488842*^9}],

Cell[BoxData[
 RowBox[{
  FractionBox["1", "2"], " ", 
  RowBox[{"(", 
   RowBox[{"r0", "-", "r1"}], ")"}], " ", 
  RowBox[{"(", 
   RowBox[{"r0", "+", "r1"}], ")"}], " ", 
  RowBox[{"(", 
   RowBox[{"\[Phi]0", "-", "\[Phi]1"}], ")"}], " ", 
  RowBox[{"Sin", "[", "\[Theta]", "]"}]}]], "Output",
 CellChangeTimes->{3.5965747653942633`*^9, 3.596574866366969*^9, 
  3.596576950722261*^9, 3.596599998652176*^9, 3.596600092981669*^9, 
  3.596601226999567*^9, 3.59660127360732*^9}],

Cell[BoxData[
 RowBox[{
  FractionBox["1", "2"], " ", 
  RowBox[{"(", 
   RowBox[{"r0", "-", "r1"}], ")"}], " ", 
  RowBox[{"(", 
   RowBox[{"r0", "+", "r1"}], ")"}], " ", 
  RowBox[{"(", 
   RowBox[{"\[Theta]0", "-", "\[Theta]1"}], ")"}]}]], "Output",
 CellChangeTimes->{3.5965747653942633`*^9, 3.596574866366969*^9, 
  3.596576950722261*^9, 3.596599998652176*^9, 3.596600092981669*^9, 
  3.596601226999567*^9, 3.596601273627451*^9}]
}, Open  ]]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Paraboloidal coordinates", "Section",
 CellChangeTimes->{{3.596654478640259*^9, 3.5966544826043673`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Manipulate", "[", 
  RowBox[{
   RowBox[{"Plot3D", "[", 
    RowBox[{
     RowBox[{
      FractionBox["1", "2"], 
      RowBox[{"(", 
       RowBox[{
        FractionBox[
         SuperscriptBox["x", "2"], 
         RowBox[{"\[Lambda]", "-", "A"}]], "+", 
        FractionBox[
         SuperscriptBox["y", "2"], 
         RowBox[{"\[Lambda]", "-", "B"}]], "-", "\[Lambda]"}], ")"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"x", ",", 
       RowBox[{"-", "8"}], ",", "8"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"y", ",", 
       RowBox[{"-", "8"}], ",", "8"}], "}"}]}], "]"}], ",", 
   RowBox[{"{", 
    RowBox[{"A", ",", "1", ",", "2"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"B", ",", 
     RowBox[{"-", "1"}], ",", 
     RowBox[{"-", "2"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\[Lambda]", ",", "0", ",", "5"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.596654484564487*^9, 3.5966544871141043`*^9}, {
  3.5966545217700863`*^9, 3.596654702057415*^9}}],

Cell[BoxData[
 TagBox[
  StyleBox[
   DynamicModuleBox[{$CellContext`A$$ = 
    1.276, $CellContext`B$$ = -1.478, $CellContext`\[Lambda]$$ = 3.29, 
    Typeset`show$$ = True, Typeset`bookmarkList$$ = {}, 
    Typeset`bookmarkMode$$ = "Menu", Typeset`animator$$, Typeset`animvar$$ = 
    1, Typeset`name$$ = "\"untitled\"", Typeset`specs$$ = {{
      Hold[$CellContext`A$$], 1, 2}, {
      Hold[$CellContext`B$$], -1, -2}, {
      Hold[$CellContext`\[Lambda]$$], 0, 5}}, Typeset`size$$ = {
    316., {100., 105.}}, Typeset`update$$ = 0, Typeset`initDone$$, 
    Typeset`skipInitDone$$ = True, $CellContext`A$4585$$ = 
    0, $CellContext`B$4590$$ = 0, $CellContext`\[Lambda]$4591$$ = 0}, 
    DynamicBox[Manipulate`ManipulateBoxes[
     1, StandardForm, 
      "Variables" :> {$CellContext`A$$ = 
        1, $CellContext`B$$ = -1, $CellContext`\[Lambda]$$ = 0}, 
      "ControllerVariables" :> {
        Hold[$CellContext`A$$, $CellContext`A$4585$$, 0], 
        Hold[$CellContext`B$$, $CellContext`B$4590$$, 0], 
        Hold[$CellContext`\[Lambda]$$, $CellContext`\[Lambda]$4591$$, 0]}, 
      "OtherVariables" :> {
       Typeset`show$$, Typeset`bookmarkList$$, Typeset`bookmarkMode$$, 
        Typeset`animator$$, Typeset`animvar$$, Typeset`name$$, 
        Typeset`specs$$, Typeset`size$$, Typeset`update$$, Typeset`initDone$$,
         Typeset`skipInitDone$$}, "Body" :> 
      Plot3D[(1/
         2) ($CellContext`x^2/($CellContext`\[Lambda]$$ - $CellContext`A$$) + \
$CellContext`y^2/($CellContext`\[Lambda]$$ - $CellContext`B$$) - \
$CellContext`\[Lambda]$$), {$CellContext`x, -8, 8}, {$CellContext`y, -8, 8}], 
      "Specifications" :> {{$CellContext`A$$, 1, 
         2}, {$CellContext`B$$, -1, -2}, {$CellContext`\[Lambda]$$, 0, 5}}, 
      "Options" :> {}, "DefaultOptions" :> {}],
     ImageSizeCache->{361., {172., 177.}},
     SingleEvaluation->True],
    Deinitialization:>None,
    DynamicModuleValues:>{},
    SynchronousInitialization->True,
    UnsavedVariables:>{Typeset`initDone$$},
    UntrackedVariables:>{Typeset`size$$}], "Manipulate",
   Deployed->True,
   StripOnInput->False],
  Manipulate`InterpretManipulate[1]]], "Output",
 CellChangeTimes->{
  3.596654526924806*^9, {3.596654619739105*^9, 3.5966546566856737`*^9}, 
   3.596654703196465*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Manipulate", "[", 
  RowBox[{
   RowBox[{"Plot3D", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        FractionBox["1", "2"], 
        RowBox[{"(", 
         RowBox[{
          FractionBox[
           SuperscriptBox["x", "2"], 
           RowBox[{"\[Lambda]", "-", "A"}]], "+", 
          FractionBox[
           SuperscriptBox["y", "2"], 
           RowBox[{"\[Lambda]", "-", "B"}]], "-", "\[Lambda]"}], ")"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"\[Lambda]", ",", "2.1", ",", "2.9", ",", "0.1"}], "}"}]}], 
      "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"x", ",", 
       RowBox[{"-", "8"}], ",", "8"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"y", ",", 
       RowBox[{"-", "8"}], ",", "8"}], "}"}], ",", 
     RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
   RowBox[{"{", 
    RowBox[{"A", ",", "1", ",", "2"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"B", ",", "3", ",", "4"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.596654763425323*^9, 3.596654845916244*^9}, {
  3.596654934878738*^9, 3.5966549389410973`*^9}, {3.5966550157701683`*^9, 
  3.596655029064395*^9}, {3.5966550621137953`*^9, 3.596655065662664*^9}, {
  3.596655162036254*^9, 3.596655205515839*^9}}],

Cell[BoxData[
 TagBox[
  StyleBox[
   DynamicModuleBox[{$CellContext`A$$ = 2., $CellContext`B$$ = 3.374, 
    Typeset`show$$ = True, Typeset`bookmarkList$$ = {}, 
    Typeset`bookmarkMode$$ = "Menu", Typeset`animator$$, Typeset`animvar$$ = 
    1, Typeset`name$$ = "\"untitled\"", Typeset`specs$$ = {{
      Hold[$CellContext`A$$], 1, 2}, {
      Hold[$CellContext`B$$], 3, 4}}, Typeset`size$$ = {360., {80., 84.}}, 
    Typeset`update$$ = 0, Typeset`initDone$$, Typeset`skipInitDone$$ = 
    True, $CellContext`A$23991$$ = 0, $CellContext`B$23992$$ = 0}, 
    DynamicBox[Manipulate`ManipulateBoxes[
     1, StandardForm, 
      "Variables" :> {$CellContext`A$$ = 1, $CellContext`B$$ = 3}, 
      "ControllerVariables" :> {
        Hold[$CellContext`A$$, $CellContext`A$23991$$, 0], 
        Hold[$CellContext`B$$, $CellContext`B$23992$$, 0]}, 
      "OtherVariables" :> {
       Typeset`show$$, Typeset`bookmarkList$$, Typeset`bookmarkMode$$, 
        Typeset`animator$$, Typeset`animvar$$, Typeset`name$$, 
        Typeset`specs$$, Typeset`size$$, Typeset`update$$, Typeset`initDone$$,
         Typeset`skipInitDone$$}, "Body" :> Plot3D[
        Table[(1/
          2) ($CellContext`x^2/($CellContext`\[Lambda] - $CellContext`A$$) + \
$CellContext`y^2/($CellContext`\[Lambda] - $CellContext`B$$) - $CellContext`\
\[Lambda]), {$CellContext`\[Lambda], 2.1, 2.9, 0.1}], {$CellContext`x, -8, 
         8}, {$CellContext`y, -8, 8}, PlotRange -> All], 
      "Specifications" :> {{$CellContext`A$$, 1, 2}, {$CellContext`B$$, 3, 
         4}}, "Options" :> {}, "DefaultOptions" :> {}],
     ImageSizeCache->{405., {138., 143.}},
     SingleEvaluation->True],
    Deinitialization:>None,
    DynamicModuleValues:>{},
    SynchronousInitialization->True,
    UnsavedVariables:>{Typeset`initDone$$},
    UntrackedVariables:>{Typeset`size$$}], "Manipulate",
   Deployed->True,
   StripOnInput->False],
  Manipulate`InterpretManipulate[1]]], "Output",
 CellChangeTimes->{{3.59665479122101*^9, 3.596654846182775*^9}, 
   3.596654940311493*^9, {3.596655017858315*^9, 3.596655029506216*^9}, 
   3.59665506594886*^9, 3.5966552064352083`*^9}]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1065, 817},
WindowMargins->{{Automatic, 155}, {Automatic, 0}},
PrintingCopies->1,
PrintingPageRange->{1, Automatic},
FrontEndVersion->"9.0 for Mac OS X x86 (32-bit, 64-bit Kernel) (November 20, \
2012)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[557, 20, 3946, 108, 196, "Input"],
Cell[CellGroupData[{
Cell[4528, 132, 107, 1, 80, "Section"],
Cell[CellGroupData[{
Cell[4660, 137, 131, 1, 44, "Subsection"],
Cell[CellGroupData[{
Cell[4816, 142, 5909, 152, 340, "Input"],
Cell[10728, 296, 869, 22, 47, "Output"],
Cell[11600, 320, 1435, 42, 47, "Output"],
Cell[13038, 364, 1417, 31, 46, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[14504, 401, 112, 1, 44, "Subsection"],
Cell[CellGroupData[{
Cell[14641, 406, 1451, 39, 80, "Input"],
Cell[16095, 447, 539, 15, 47, "Output"],
Cell[16637, 464, 383, 9, 28, "Output"],
Cell[17023, 475, 361, 9, 28, "Output"],
Cell[17387, 486, 460, 12, 47, "Output"]
}, Open  ]]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[17908, 505, 105, 1, 80, "Section"],
Cell[CellGroupData[{
Cell[18038, 510, 139, 3, 44, "Subsection"],
Cell[CellGroupData[{
Cell[18202, 517, 6224, 167, 348, "Input"],
Cell[24429, 686, 1439, 41, 47, "Output"],
Cell[25871, 729, 3444, 104, 101, "Output"],
Cell[29318, 835, 2540, 50, 97, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[31907, 891, 112, 1, 44, "Subsection"],
Cell[CellGroupData[{
Cell[32044, 896, 1677, 45, 92, "Input"],
Cell[33724, 943, 562, 15, 48, "Output"],
Cell[34289, 960, 472, 12, 32, "Output"],
Cell[34764, 974, 476, 12, 47, "Output"],
Cell[35243, 988, 434, 11, 47, "Output"]
}, Open  ]]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[35738, 1006, 111, 1, 80, "Section"],
Cell[CellGroupData[{
Cell[35874, 1011, 1004, 30, 54, "Input"],
Cell[36881, 1043, 2274, 46, 366, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[39192, 1094, 1263, 34, 85, "Input"],
Cell[40458, 1130, 2127, 41, 298, "Output"]
}, Open  ]]
}, Open  ]]
}
]
*)

(* End of internal cache information *)
